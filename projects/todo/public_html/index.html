<!doctype html>

<html lang="en">
    <head>
    <meta charset="utf-8">

    <title>Todo "App"</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="Logan" content="SitePoint">

    <style></style>

    <!-- jQuery -->
    <script
    src="https://code.jquery.com/jquery-3.5.0.min.js"
    integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
    crossorigin="anonymous"></script>

    </head>

    <body>

        <!-- <a href="http://localhost:3000/readNotes">Notes</a>  -->

        <!-- <input id="noteTitel" type="text"> -->
        <!-- <input id="note" type="text"> -->
        <!-- <button id="saveButton">Save</button> -->

        <button id="NewNote">New Note</button>

        <div id="notes"></div>

        <script>
            $(document).ready(() => {

                

               

                /*
                $.post("http://localhost:3000/markComplete", objectToSend, (dataToGet) => {
                console.log(`Server says: ${dataToGet.markedComplete}`);
                });
                */

                // $.post("http://localhost:3000/updateNote", objectToSend, (dataToGet) => {
                //   console.log(`Server says: ${dataToGet.updatedStatus}`);
                // });
                
                // saveButton.click(() =>{
                //     let note = $("#note").val(); 
                //     //let noteTitel = $("#noteTitel").val(); 


                //     let objectToSend = {
                //         //noteTitel: noteTitel,
                //         note: note,
                //         author: "Logan"
                //     };

                //     $.post("http://localhost:3000/deleteNote, objectToSend, (dataToGet) => {
                //         console.log("Server Responded!")
                //     });

                // });





                //  saveButton.click($.post("http://localhost:3000/newNote", objectToSend, (dataToGet) => {
                //     let note = $("#note").val(); 
                //     console.log(dataToGet);
                //  }));

                let arrCreateDate = [];

                $.post("http://localhost:3000/readNotes", {}, (dataToGet) => {

                    let allNotesArray = dataToGet.notes;
                    //console.log(allNotesArray);

                    let divContent = ``;
                    //let arrCreateDate = [];
                    for(let i = 0; i < allNotesArray.length; i++){
                        
                        //str = `${str}\nNote${i} ${allNotesArray[i].create_date}` 

                        let button = `<button id=${allNotesArray[i].create_date}>Note${i} ${allNotesArray[i].create_date}</button>`

                        divContent = divContent + '\n' + button;
                        
                        //console.log(`${allNotesArray[i].create_date}`)

                        arrCreateDate.push(`${allNotesArray[i].create_date}`);
                    }
                    $("#notes").html(`${divContent}`);

                    $("button").click((e) => {

                        console.log(allNotesArray);

                        if(e.target.id === "NewNote"){
                            
                            let myPopup = `
                            <div id="popup-block">
                                <div id="popup-container">
                                <textarea id="note" type="text" rows="20" cols="50"></textarea>
                                    <button id="saveButton">Save</button>
                                </div>
                            </div>`;

                            $("body").append(myPopup);

                            $("#popup-block").css({
                                "position": "absolute",
                                "top": "0",
                                "left": "0",
                                "width": "100%",
                                "height": "100%",
                                "background-color": "rgba(255, 255, 0, .5)"
                            });

                            let popup = $("#popup-container");

                            popup.css({
                                "margin": "0 auto",
                                "width": "300px",
                                "height": "300px",
                                "background-color": "white",
                                "border": "solid 5px yellow"
                            });

                            popup.append("<button id='close'>Close</button>");

                            $("#close").click(() => {
                                $("#close").parent().parent().remove();
                                location.reload();
                            });

                            $("#saveButton").click(() =>{
                                let note = $("#note").val(); 

                                //console.log(note);

                                let objectToSend = {
                                    note: note,
                                    author: "Logan"
                                };

                                $.post("http://localhost:3000/newNote", objectToSend, (dataToGet) => {
                                    console.log("Server Responded!")
                                });

                            });

                        } else {

                            for(let i = 0; i < allNotesArray.length; i++){
                                // console.log(`${allNotesArray[i].create_date}`);
                                 //console.log(e.target.id);
                                if(e.target.id === `${allNotesArray[i].create_date}`){

                                    //console.log("match!");
                                    // Setting up our popup.
                                    let myPopup = `
                                    <div id="popup-block">
                                        <div id="popup-container">
                                        <textarea id="note" type="text" rows="20" cols="50">${allNotesArray[i].note}</textarea>
                                            <button id="saveButton">Save</button>
                                            <button id="delete">Delete</button>
                                        </div>
                                    </div>`;

                                    $("body").append(myPopup);

                                    $("#saveButton").click(() =>{

                                        let note = $("#note").val(); 

                                        let objectToSend = {
                                            updated_note: note,
                                            create_date: allNotesArray[i].create_date,
                                            author: "Logan"
                                        }

                                        $.post("http://localhost:3000/updateNote", objectToSend, (dataToGet) => {
                                          //console.log(`Server says: ${dataToGet.updatedStatus}`);
                                        });

                                    });

                                    $("#delete").click(() =>{
                                        
                                        let objectToSend = {
                                            create_date: allNotesArray[i].create_date,
                                            author: "Logan"
                                        }

                                        $.post("http://localhost:3000/deleteNote", objectToSend, (dataToGet) => {
                                            console.log(`Server says: ${dataToGet.updatedStatus}`);
                                        });

                                        location.reload();

                                    });

                                    

                                    $("#popup-block").css({
                                        "position": "absolute",
                                        "top": "0",
                                        "left": "0",
                                        "width": "100%",
                                        "height": "100%",
                                        "background-color": "rgba(255, 255, 0, .5)"
                                    });

                                    let popup = $("#popup-container");

                                    popup.css({
                                        "margin": "0 auto",
                                        "width": "300px",
                                        "height": "300px",
                                        "background-color": "white",
                                        "border": "solid 5px yellow"
                                    });

                                    popup.append("<button id='close'>Close</button>");

                                    $("#close").click(() => {
                                        $("#close").parent().parent().remove();
                                        location.reload();
                                    });
                                }
                            }
                        }
                    });
                });
            });
        </script>
    </body>
</html>
